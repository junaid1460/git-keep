#!/bin/bash
repo=$1
command=$2
parameter=$3
# import local files
dir="$(cd $(dirname $0);pwd)"
local_dir="$dir/src"
source "$local_dir/variables.sh"
source "$local_dir/colors.sh"
source "$local_dir/helpers.sh"
source "$local_dir/error.sh"
source "$local_dir/editor.sh"
source "$local_dir/functions.sh"
source "$local_dir/functions.ls.sh"
source "$local_dir/functions.update.sh"
source "$local_dir/functions.precheck.sh"

if [ ! -d $repo ]
then 
    echo $repo does not exist! Please create it before usage
    exit
fi

# change directory to repo
cd $repo 




# if repository not initialized then notify
if [ "$command" != "init" ] && [ "$command" != "i" ]  && [ ! -d ".git" ]
then
    color $Red
    print "Repository not initialized yet!"
    color $Green
    print "please run :"
    color $Color_Off
    print  "    doc [init|i]"
    print 
    exit
fi

verify_requirements # verify required file exists or not, if not create them
# commands

if [ $# -gt 0 ]
then
    if [ "$command" == "init" ] || [ "$command" == "i" ]
    then
        if [ -d ".git" ]
        then
            colori $Yellow
            echo "Already Initialized"
        else
            colori $UGreen
            echo "Initializing_repo :"
            colori $Red
            git init
        fi
    elif [ "$command" == "add" ] || [ "$command" == "a" ]
    then
        add
    elif [ "$command" == "list-files" ] || [ "$command" == "ls" ]
    then
        list_info
    elif [ "$command" == "edit" ] || [ "$command" == "e" ]
    then
        if [ "$parameter" == "header" ]
        then
            edit $header_file
            updateREADME
            commit? "Changed header."
        elif [ "$parameter" == "footer" ]
        then
            edit $footer_file
            updateREADME
            commit? "Changed footer."

        elif [ "$parameter" == "" ]
        then
            colori $Red 
            printi "Invalid file name!\n"
        else
            # edit file with number
        fi
        
    else
        color $Red
        echo "Invalid parameters"
        error
    fi
    exit 0

else
    error
fi


color $Color_Off